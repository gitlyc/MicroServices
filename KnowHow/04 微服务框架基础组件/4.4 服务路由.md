#### 服务路由

负载均衡的出发点是提供服务分发而不是解决路由问题，常见的静态、动态负载均衡算法也无法实现精细化的路由管理，但是负载均衡也可以简单看做是路由方案的一种。服务路由的管理可归纳为三大类，直接路由、间接路由和路由规则。路由策略整体如下：

![服务路由总览](D:\documents\技术文档\md\MicroServices\KnowHow\00 common\images\04\服务路由总览.png)

##### 1. 直接路由

服务消费者需要感知服务提供者的地址信息，基本思路是通过配置中心或者[数据库](https://cloud.tencent.com/solution/database?from=10680)，当服务消费者需要调用某个服务时，基于配置中心或者数据库中存储的目标服务的具体地址构建链路完成调用。

存在的问题：

- 增强了服务提供者和消费者之间的耦合度；
- 创建和维护配置中心或数据库持久化操作需要成本。

##### 2. 间接路由

强调解耦思想并充分利用了发布-订阅模式作用，发布者发布事件，订阅者关注自身所想关注的事件，发布者和订阅者并不需要感知对方的存在，两者之间通过传输事件的基础设施进行完全解耦。

![间接路由](D:\documents\技术文档\md\MicroServices\KnowHow\00 common\images\04\间接路由.png)

在微服务架构里面，实现间接路由的组件一般称为服务注册中心从概念上讲就是发布-订阅模式中传输事件的基础设施，可以把服务的地址信息理解为事件的具体表现。通过服务注册中心，服务提供者发布服务到注册中心，服务消费者订阅感兴趣的服务，服务消费者只需要知道有哪些服务，而不需要知道服务具体在什么位置，从而实现间接路由。

##### 3. 路由规则

间接路由解决了路由解耦问题，面向全路由场景。但是在服务故障、高峰期导流、业务相关定制路由等特定场景下，依靠间接路由提供静态路由信息并不能满足要求，这就需要动态路由，而动态路由规则需要通过路由规则进行实现。路由规则常见的实现方案是白名单和黑名单，即把需要路由的服务地址信息放入到可以控制是否可见的路由池中。更为复杂的可以用Python等脚本语言实现定制化。