#### 配置管理

在微服务架构中，一般都需要引入配置中心的设计思想和相关工具。

##### 1. 配置中心模型

**4大分类**

先来梳理下配置相关的内容和分类：

- 按配置的来源划分：

  源代码文件、数据库和远程调用。

- 按配置的适用环境划分：

  开发环境、测试环境、预发布环境、生产环境等。

- 按配置的集成阶段划分：

  编译时—源代码级的配置+配置文件和源代码一起提交到代码仓库； 打包时—通过某种方式将配置打入最终的应用包中； 运行时—应用启动时并不知道具体配置，需从本地或远程获取配置，在正常启动。

- 按配置的加载方式划分：

  单次加载型配置、动态加载型配置。

**4个核心需求**

依照配置相关的内容和分类来看，构建一个合适的配置中心，至少需要满足以下4个核心需求：

（1）非开发环境下应用配置的保密性，避免将关键配置写入源代码；

（2）不同部署环境下应用配置的隔离性，比如非生产环境的配置不能参与生产环境；

（3）同一部署环境下的服务器应用配置的一致性，即所有服务器使用同一份配置；

（4）分布式环境下应用配置的可管理性，即提供远程配置能力。

**2个维度分析**

采取配置中心也就意味着采用集中式配置管理的设计思想。

![集中式配置中心](..\00 common\images\04\集中式配置中心.png)

- 维度一：在集中式配置中心中，开发、测试和生产等不同环境配置信息统一保存在配置中心中；

- 维度二;分布式集群环境，需要确保集群中同一类服务的所有服务器保存同一份配置文件并且能够同步更新。

#### 2. 分布式协调机制

配置中心在实现上需要满足3大需求：高效获取、实时感知、分布式访问。为满足这三大需求，配置中心需要依赖分布式协调机制，即通过一定的方法确保配置信息在分布式环境中的各个服务中能够得到实时、一致管理。目前业界主流的分布式协调框架为Zookeeper。